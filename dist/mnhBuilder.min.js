class MnhBuilder{static init=data=>{let mnhPageStructure=data.layout_data,targetDiv=data.container,addButton=data.add_button,codeButton=data.code_button,saveButton=data.save_button,loadButton=data.load_button,styleString=`\n      #${targetDiv} * { transition: all 0.3s ease-out; }\n      #${targetDiv} .row { transition: padding 0.3s; }\n      #${targetDiv} .row:hover { border-left: 2px solid red; padding-left: 50px; }\n      #${targetDiv} .row div .hoverable:hover { opacity: 0.5; cursor: pointer; }\n    `;const style=document.createElement("style");style.textContent=styleString,document.head.append(style);let ckeditorConfig={toolbar:[{name:"basicstyles",items:["Source","Bold","Italic","Underline","Strike"]},{name:"paragraph",items:["NumberedList","BulletedList","-","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]},{name:"links",items:["Link","Unlink"]},{name:"styles",items:["Styles","Format"]}],forcePasteAsPlainText:!0},contentEditor=document.createElement("div");contentEditor.id="contentEditorForm",contentEditor.style.position="absolute",contentEditor.style.width="100%",contentEditor.style.height="100%",contentEditor.style.zIndex="9999",contentEditor.style.display="grid",contentEditor.style.placeItems="center",contentEditor.style.backgroundColor="rgba(0,0,0,0.5)";const renderPreview=()=>{document.querySelector(`#${targetDiv}`).innerHTML="",mnhPageStructure.forEach((item,index,obj)=>{let panel=document.createElement("div"),editorPanel=document.createElement("div");editorPanel.id=`row-${index}`,editorPanel.style.position="absolute",editorPanel.style.opacity="0",editorPanel.style.marginLeft="-40px",editorPanel.style.fontSize="0.5em",editorPanel.style.zIndex="999",editorPanel.style.cursor="pointer",editorPanel.innerHTML=`\n        <button id="remove-row-${index}" title="Delete this panel" class="btn btn-link text-danger btn-sm m-0 p-0"><i class="fa fa-fw fa-trash-alt"></i></button>\n        <button id="edit-classes-row-${index}" title="Edit Class" class="btn btn-link text-danger btn-sm m-0 p-0"><i class="fa fa-fw fa-cog"></i></button>\n        <br/>\n        <button id="move-up-row-${index}" title="Move up" class="btn btn-link text-danger btn-sm m-0 p-0"><i class="fa fa-fw fa-arrow-up"></i></button>\n        <button id="move-down-row-${index}" title="Move down" class="btn btn-link text-danger btn-sm m-0 p-0"><i class="fa fa-fw fa-arrow-down"></i></button>\n        `,editorPanel.querySelector(`#remove-row-${index}`).onclick=()=>{if(confirm("Are you sure?")){let newStructure=mnhPageStructure;newStructure.splice(index,1),mnhPageStructure=newStructure,renderPreview()}},editorPanel.querySelector(`#move-up-row-${index}`).onclick=()=>{if(index<=0)alert("Panel can't be moved up.");else{let temp=mnhPageStructure[index-1];mnhPageStructure[index-1]=mnhPageStructure[index],mnhPageStructure[index]=temp}renderPreview()},editorPanel.querySelector(`#move-down-row-${index}`).onclick=()=>{if(index>=mnhPageStructure.length-1)alert("Panel can't be moved down.");else{let temp=mnhPageStructure[index+1];mnhPageStructure[index+1]=mnhPageStructure[index],mnhPageStructure[index]=temp}renderPreview()},editorPanel.querySelector(`#edit-classes-row-${index}`).onclick=()=>{let classes=mnhPageStructure[index].classes.join(" "),editedClasses=prompt("Add classes (separate by space):",classes);if(editedClasses){let newClasses=editedClasses.split(" ");mnhPageStructure[index].classes=newClasses}renderPreview()},panel.onmouseover=()=>{panel.querySelector(`#row-${index}`).style.opacity="1"},panel.onmouseout=()=>{panel.querySelector(`#row-${index}`).style.opacity="0"},panel.appendChild(editorPanel),item.classes.forEach(val=>{panel.classList.add(val)}),item.cols.forEach((itemI,indexI,objI)=>{let child=document.createElement("div");itemI.classes.forEach(val=>{child.classList.add(val)}),child.setAttribute("data-parent",index),child.setAttribute("data-child",indexI),!itemI.content||itemI.content.length<1?child.innerHTML="\n          <div class='text-center hoverable p-4 mt-2 mb-4 rounded-lg' style=\"color:gray; background-color:#e3e3e3\">\n            <small>Empty Column</small>\n          </div>\n          ":itemI.content.forEach((value,indexJ)=>{let _content=document.createElement("div");_content.style.position="relative";let _tools=`\n              <div id='row-${index}-col-${indexI}-item-${indexJ}' style="position:absolute;height:100%;width:100%;display:grid;place-items:center;opacity:0;z-index:900; background-color: rgba(255, 255, 255, 0.8)">\n                <span class="bg-white shadow px-3 py-2 rounded-pill">\n                 <small>\n                  <a class="text-danger" id="edit-content-row-${index}-col-${indexI}-item-${indexJ}" title="Edit Konten" href="#"><i class="fa fa-fw fa-edit mx-1"></i></a>\n                  <a class="text-danger" id="move-up-content-row-${index}-col-${indexI}-item-${indexJ}" title="Move up" href="#"><i class="fa fa-fw fa-arrow-up mx-1"></i></a>\n                  <a class="text-danger" id="move-down-content-row-${index}-col-${indexI}-item-${indexJ}" title="Move down" href="#"><i class="fa fa-fw fa-arrow-down mx-1"></i></a>\n                  <a class="text-danger" id="delete-content-row-${index}-col-${indexI}-item-${indexJ}" title="Delete content" href="#"><i class="fa fa-fw fa-trash-alt mx-1"></i></a>\n                 </small>\n                </span>\n              </div>\n              `;_content.innerHTML=`${_tools}<div class="hoverable">${value}</div>`,_content.addEventListener("mouseover",()=>{_content.querySelector(`#row-${index}-col-${indexI}-item-${indexJ}`).style.opacity="1"}),_content.addEventListener("mouseleave",()=>{_content.querySelector(`#row-${index}-col-${indexI}-item-${indexJ}`).style.opacity="0"}),_content.querySelector(`#edit-content-row-${index}-col-${indexI}-item-${indexJ}`).addEventListener("click",()=>{if(mnhPageStructure[index].cols[indexI].content[indexJ].startsWith('<div data-type="img"')){let _toBeEdited=(new DOMParser).parseFromString(mnhPageStructure[index].cols[indexI].content[indexJ],"text/html"),addContent=contentEditor;addContent.innerHTML=`\n                    <div style="max-width:679px; width:100%" class="p-3 p-md-4 bg-white shadow rounded-lg">\n                    <h6>Image Detail:</h6>\n                    \n                    <div class="my-4">\n                    <input type="text" value="${_toBeEdited.querySelector("img").getAttribute("src")}" id="editorImageURL" class="form-control form-control-sm mb-2" placeholder="URL (Example: https://example.com/gambar.jpg)" />\n                    <input type="text" value="${_toBeEdited.querySelector("img").getAttribute("alt")}" id="editorImageAlt" class="form-control form-control-sm mb-2" placeholder="Description (Example: Organization Name)" />\n                    <input type="text" value="${_toBeEdited.querySelector("a")?_toBeEdited.querySelector("a").getAttribute("href"):""}" id="editorImageHref" class="form-control form-control-sm mb-2" placeholder="Hyperlink (Example: https://example.com)" />\n                    <input type="text" value="${_toBeEdited.querySelector("img").getAttribute("class")}" id="editorImageClass" class="form-control form-control-sm mb-2" placeholder="Classes for <img> (separate with space) (Example: rounded-circle, w-100, dll)" />\n                    <input type="text" value="${_toBeEdited.querySelector("div").getAttribute("class")}" id="editorContainerClass" class="form-control form-control-sm mb-2" placeholder="Classes for <div> (separate with space) (Example: text-center, bg-dark, dll)" />\n                    </div>\n          \n                    <hr/>\n                    <h6>Code Preview:</h6>\n                    <pre id="editorImageCodePreview"></pre>\n          \n                    <div class="text-center pt-3">\n                      <button class="btn btn-danger rounded-pill px-3 btn-sm" id="contentEditorFormSave">Save Content</button>\n                      <a href="#" class="btn btn-link btn-sm text-danger" id="contentEditorFormCancel">Cancel</a>\n                    </div>\n                    </div>\n                    `;let updateCodePreview=()=>{addContent.querySelector("#editorImageCodePreview").textContent=`<div data-type="img" class="${addContent.querySelector("#editorContainerClass").value}">\n                      ${addContent.querySelector("#editorImageHref").value?`<a href="${addContent.querySelector("#editorImageHref").value}">`:""}<img \n                        src="${addContent.querySelector("#editorImageURL").value}" \n                        alt="${addContent.querySelector("#editorImageAlt").value}" \n                        class="${addContent.querySelector("#editorImageClass").value}" \n                      />${addContent.querySelector("#editorImageHref").value?"</a>":""}\n                    </div>`};updateCodePreview(),addContent.querySelectorAll("input").forEach(inp=>{inp.addEventListener("keyup",()=>{updateCodePreview()})}),addContent.querySelector("#contentEditorFormSave").onclick=()=>{if(addContent.querySelector("#editorImageURL").value&&addContent.querySelector("#editorImageAlt").value){let _content=addContent.querySelector("#editorImageCodePreview").textContent;mnhPageStructure[index].cols[indexI].content[indexJ]=_content,renderPreview(),document.querySelector("#contentEditorForm").remove()}else alert("URL and description must not be empty")},addContent.querySelector("#contentEditorFormCancel").onclick=()=>{document.querySelector("#contentEditorForm").remove()},document.body.insertBefore(contentEditor,document.body.firstChild)}else if(mnhPageStructure[index].cols[indexI].content[indexJ].startsWith('<div data-type="content"')){let editContent=contentEditor;editContent.innerHTML=`\n                  <div style="max-width:679px; width:100%" class="p-3 p-md-4 bg-white shadow rounded-lg">\n                    <textarea name="ckeditor">${mnhPageStructure[index].cols[indexI].content[indexJ]}</textarea>\n                    <div class="text-center pt-3">\n                      <button class="btn btn-danger rounded-pill px-3 btn-sm" id="contentEditorFormSave">Save Content</button>\n                      <a href="#" class="btn btn-link btn-sm text-danger" id="contentEditorFormCancel">Cancel</a>\n                    </div>\n                  </div>\n                  `,editContent.querySelector("#contentEditorFormSave").onclick=()=>{let _content=CKEDITOR.instances.ckeditor.getData();mnhPageStructure[index].cols[indexI].content[indexJ]=_content,renderPreview(),document.querySelector("#contentEditorForm").remove()},editContent.querySelector("#contentEditorFormCancel").onclick=()=>{document.querySelector("#contentEditorForm").remove()},document.body.insertBefore(contentEditor,document.body.firstChild),CKEDITOR.replace("ckeditor",ckeditorConfig)}}),_content.querySelector(`#delete-content-row-${index}-col-${indexI}-item-${indexJ}`).addEventListener("click",()=>{confirm("Are you sure?")&&(mnhPageStructure[index].cols[indexI].content.splice(indexJ,1),renderPreview())}),_content.querySelector(`#move-up-content-row-${index}-col-${indexI}-item-${indexJ}`).addEventListener("click",()=>{if(indexJ<=0)alert("Content can't be moved up");else{let temp=mnhPageStructure[index].cols[indexI].content[indexJ-1];mnhPageStructure[index].cols[indexI].content[indexJ-1]=mnhPageStructure[index].cols[indexI].content[indexJ],mnhPageStructure[index].cols[indexI].content[indexJ]=temp}renderPreview()}),_content.querySelector(`#move-down-content-row-${index}-col-${indexI}-item-${indexJ}`).addEventListener("click",()=>{if(indexJ>=mnhPageStructure[index].cols[indexI].content.length-1)alert("Content can't be moved down.");else{let temp=mnhPageStructure[index].cols[indexI].content[indexJ+1];mnhPageStructure[index].cols[indexI].content[indexJ+1]=mnhPageStructure[index].cols[indexI].content[indexJ],mnhPageStructure[index].cols[indexI].content[indexJ]=temp}renderPreview()}),child.appendChild(_content)});let colOptions=document.createElement("div");colOptions.classList.add("dropdown"),colOptions.id=`col-${indexI}-row-${index}-options`,colOptions.style.position="absolute",colOptions.style.right="10px",colOptions.style.top="-15px",colOptions.style.opacity="0",colOptions.style.zIndex="999",colOptions.innerHTML=`\n          <div class="pb-1 px-3 rounded-pill bg-danger shadow">\n           <small>\n           <a title="Add Content" class="text-white mx-1" id="add-content-row-${index}-col-${indexI}" href="#"><i class="fa fa-fw fa-align-left"></i></a>\n           <a title="Add Image" class="text-white mx-1" id="add-img-row-${index}-col-${indexI}" href="#"><i class="fa fa-fw fa-images"></i></a>\n           <a title="Edit Class" class="text-white mx-1" id="modify-class-row-${index}-col-${indexI}" href="#"><i class="fa fa-fw fa-cog"></i></a>\n           </small>\n          </div>\n        `,child.onmouseover=()=>{child.querySelector(`#col-${indexI}-row-${index}-options`).style.opacity="1",child.querySelector(`#col-${indexI}-row-${index}-options`).style.top="-10px"},child.onmouseout=()=>{child.querySelector(`#col-${indexI}-row-${index}-options`).style.opacity="0",child.querySelector(`#col-${indexI}-row-${index}-options`).style.top="-15px"},colOptions.querySelector(`#add-content-row-${index}-col-${indexI}`).addEventListener("click",()=>{let addContent=contentEditor;addContent.innerHTML='\n            <div style="max-width:679px; width:100%" class="p-3 p-md-4 bg-white shadow rounded-lg">\n            <textarea name="ckeditor"></textarea>\n            <div class="text-center pt-3">\n              <button class="btn btn-danger rounded-pill px-3 btn-sm" id="contentEditorFormSave">Save Content</button>\n              <a href="#" class="btn btn-link btn-sm text-danger" id="contentEditorFormCancel">Cancel</a>\n            </div>\n            </div>\n            ',addContent.querySelector("#contentEditorFormSave").onclick=()=>{let _content=`<div data-type="content">${CKEDITOR.instances.ckeditor.getData()}</div>`;mnhPageStructure[index].cols[indexI].content.push(_content),renderPreview(),document.querySelector("#contentEditorForm").remove()},addContent.querySelector("#contentEditorFormCancel").onclick=()=>{document.querySelector("#contentEditorForm").remove()},document.body.insertBefore(contentEditor,document.body.firstChild),CKEDITOR.replace("ckeditor",ckeditorConfig)}),colOptions.querySelector(`#add-img-row-${index}-col-${indexI}`).addEventListener("click",()=>{let addContent=contentEditor;addContent.innerHTML='\n            <div style="max-width:679px; width:100%" class="p-3 p-md-4 bg-white shadow rounded-lg">\n            <h6>Image Detail:</h6>\n            \n            <div class="my-4">\n            <input type="text" id="editorImageURL" class="form-control form-control-sm mb-2" placeholder="URL (Example: https://example.com/gambar.jpg)" />\n            <input type="text" id="editorImageAlt" class="form-control form-control-sm mb-2" placeholder="Description (Example: Organization Name)" />\n            <input type="text" id="editorImageHref" class="form-control form-control-sm mb-2" placeholder="Hyperlink (Example: https://example.com)" />\n            <input type="text" id="editorImageClass" class="form-control form-control-sm mb-2" placeholder="Classes for <img> (separate with space) (Example: rounded-circle, w-100, dll)" />\n            <input type="text" id="editorContainerClass" class="form-control form-control-sm mb-2" placeholder="Classes for <div> (separate with space) (Example: text-center, bg-dark, dll)" />\n            </div>\n  \n            <hr/>\n            <h6>Code Preview:</h6>\n            <pre id="editorImageCodePreview"></pre>\n  \n            <div class="text-center pt-3">\n              <button class="btn btn-danger rounded-pill px-3 btn-sm" id="contentEditorFormSave">Save Content</button>\n              <a href="#" class="btn btn-link btn-sm text-danger" id="contentEditorFormCancel">Cancel</a>\n            </div>\n            </div>\n            ';let updateCodePreview=()=>{addContent.querySelector("#editorImageCodePreview").textContent=`<div data-type="img" class="${addContent.querySelector("#editorContainerClass").value}">\n    ${addContent.querySelector("#editorImageHref").value?`<a href="${addContent.querySelector("#editorImageHref").value}">`:""}<img \n      src="${addContent.querySelector("#editorImageURL").value}" \n      alt="${addContent.querySelector("#editorImageAlt").value}" \n      class="${addContent.querySelector("#editorImageClass").value}" \n    />${addContent.querySelector("#editorImageHref").value?"</a>":""}\n  </div>`};updateCodePreview(),addContent.querySelectorAll("input").forEach(inp=>{inp.addEventListener("keyup",()=>{updateCodePreview()})}),addContent.querySelector("#contentEditorFormSave").onclick=()=>{if(addContent.querySelector("#editorImageURL").value&&addContent.querySelector("#editorImageAlt").value){let _content=addContent.querySelector("#editorImageCodePreview").textContent;mnhPageStructure[index].cols[indexI].content.push(_content),renderPreview(),document.querySelector("#contentEditorForm").remove()}else alert("URL and description must not be empty")},addContent.querySelector("#contentEditorFormCancel").onclick=()=>{document.querySelector("#contentEditorForm").remove()},document.body.insertBefore(contentEditor,document.body.firstChild)}),colOptions.querySelector(`#modify-class-row-${index}-col-${indexI}`).addEventListener("click",()=>{let classes=mnhPageStructure[index].cols[indexI].classes.join(" "),editedClasses=prompt("Add classes for this column (separate with spaces):",classes);if(editedClasses){let newClasses=editedClasses.split(" ");mnhPageStructure[index].cols[indexI].classes=newClasses}renderPreview()}),child.appendChild(colOptions),panel.appendChild(child)}),document.querySelector(`#${targetDiv}`).appendChild(panel)})};document.querySelector(`#${addButton}`).onclick=()=>{let cols=prompt("Add column: (Example: 1/2/3/4)"),colCount=parseInt(cols);if(colCount)if(colCount<1||colCount>4)alert("Please select one of these: 1, 2, 3, 4");else{let addedColumns=[];switch(colCount){case 1:addedColumns=[{classes:["col-md-12"],content:[]}];break;case 2:addedColumns=[{classes:["col-md-6"],content:[]},{classes:["col-md-6"],content:[]}];break;case 3:addedColumns=[{classes:["col-md-4"],content:[]},{classes:["col-md-4"],content:[]},{classes:["col-md-4"],content:[]}];break;case 4:addedColumns=[{classes:["col-md-3"],content:[]},{classes:["col-md-3"],content:[]},{classes:["col-md-3"],content:[]},{classes:["col-md-3"],content:[]}]}let row={classes:["row"],cols:addedColumns};mnhPageStructure.push(row),renderPreview()}},saveButton&&(document.querySelector(`#${saveButton}`).onclick=()=>{let dataStr="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(mnhPageStructure)),downloadAnchorNode=document.createElement("a");downloadAnchorNode.setAttribute("href",dataStr),downloadAnchorNode.setAttribute("download","my_layout.json"),document.body.appendChild(downloadAnchorNode),downloadAnchorNode.click(),downloadAnchorNode.remove()}),loadButton&&(document.querySelector(`#${loadButton}`).onclick=()=>{let fileOpener=document.createElement("input");if(fileOpener.type="file",fileOpener&&document.createEvent){let evt=document.createEvent("MouseEvents");evt.initEvent("click",!0,!1),fileOpener.dispatchEvent(evt)}fileOpener.onchange=()=>{let file=fileOpener.files[0];if(file){let reader=new FileReader;reader.readAsText(file,"UTF-8"),reader.onload=function(evt){mnhPageStructure=JSON.parse(evt.target.result),renderPreview()},reader.onerror=function(evt){alert("Error reading file")},fileOpener.remove()}}}),codeButton&&(document.querySelector(`#${codeButton}`).onclick=()=>{let htmlCode="";mnhPageStructure.forEach(rows=>{let rowText=`<div class="${rows.classes.join(" ")}">`,columnText="";rows.cols.forEach(cols=>{let colContents="";cols.content.forEach(contents=>{let div=document.createElement("div");div.innerHTML=contents,colContents+=div.querySelector("div").innerHTML,div.remove()}),columnText+=`<div class="${cols.classes.join(" ")}">${colContents}</div>`}),rowText+=`${columnText}</div>`,htmlCode+=rowText});const el=document.createElement("textarea");el.value=htmlCode,el.setAttribute("readonly",""),el.style.position="absolute",el.style.left="-9999px",document.body.appendChild(el);const selected=document.getSelection().rangeCount>0&&document.getSelection().getRangeAt(0);el.select(),document.execCommand("copy"),document.body.removeChild(el),selected&&(document.getSelection().removeAllRanges(),document.getSelection().addRange(selected)),alert("The HTML code has been copied to your clipboard")}),renderPreview()}}